<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: #000;
      }
    </style>
  </head>
  <body>
    <script type="module">
      import * as THREE from "https://web.cs.manchester.ac.uk/three/three.js-master/build/three.module.js";
      import { OrbitControls } from "https://web.cs.manchester.ac.uk/three/three.js-master/examples/jsm/controls/OrbitControls.js";

      let scene, camera, renderer;
      let sunMesh, earthMesh, moonMesh, cloudMesh, earthSystem;
      let ellipseCurve, controls;
      const textureLoader = new THREE.TextureLoader();

      function init() {
        scene = new THREE.Scene();

        camera = new THREE.PerspectiveCamera(
          75,
          window.innerWidth / window.innerHeight,
          0.1,
          10000
        );
        camera.position.set(0, 30, 500);
        camera.lookAt(0, 0, 0);
        scene.add(camera);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Starry background
        const starGeometry = new THREE.SphereGeometry(5000, 64, 64);
        const starMaterial = new THREE.MeshBasicMaterial({
          map: textureLoader.load("./textures/eso0932a.jpg"),
          side: THREE.DoubleSide,
        });
        const starMesh = new THREE.Mesh(starGeometry, starMaterial);
        scene.add(starMesh);

        // Sun
        const sunGeometry = new THREE.SphereGeometry(109, 400, 200);
        const sunMaterial = new THREE.MeshStandardMaterial({
          map: textureLoader.load("./textures/2k_sun.jpg"),
          emissive: 0xffd700,
          emissiveIntensity: 0.5,
        });
        sunMesh = new THREE.Mesh(sunGeometry, sunMaterial);
        scene.add(sunMesh);

        // Lights
        const sunLight = new THREE.PointLight(0xffffff, 1.8, 0);
        scene.add(sunLight);

        const ambientLight = new THREE.AmbientLight(0x404040, 1.0);
        scene.add(ambientLight);

        // Earth
        const earthGeometry = new THREE.SphereGeometry(25, 50, 50);
        const earthMaterial = new THREE.MeshPhongMaterial({
          map: textureLoader.load("./textures/Earthmap1000x500.jpg"),
          color: 0xffffff,
          shininess: 15,
        });
        earthMesh = new THREE.Mesh(earthGeometry, earthMaterial);

        earthSystem = new THREE.Group();
        earthSystem.add(earthMesh);

        // Clouds
        const cloudGeometry = new THREE.SphereGeometry(25.1, 50, 50);
        const cloudMaterial = new THREE.MeshPhongMaterial({
          map: textureLoader.load("./textures/clouds.png"),
          transparent: true,
          alphaTest: 0.5,
          side: THREE.DoubleSide,
          depthWrite: false,
        });
        cloudMesh = new THREE.Mesh(cloudGeometry, cloudMaterial);
        earthSystem.add(cloudMesh);

        // Moon
        const moonGeometry = new THREE.SphereGeometry(5, 40, 20);
        const moonMaterial = new THREE.MeshPhongMaterial({
          map: textureLoader.load("./textures/lroc_color_poles_1k.jpg"),
        });
        moonMesh = new THREE.Mesh(moonGeometry, moonMaterial);
        moonMesh.position.set(50, 0, 0);
        earthSystem.add(moonMesh);

        scene.add(earthSystem);

        // Earth's orbit
        ellipseCurve = new THREE.EllipseCurve(
          0,
          0,
          300,
          200,
          0,
          2 * Math.PI,
          false,
          0
        );
        const orbitPoints = ellipseCurve.getPoints(100);
        const orbitGeometry = new THREE.BufferGeometry().setFromPoints(
          orbitPoints
        );
        const orbitMaterial = new THREE.LineBasicMaterial({ color: 0xffffff });
        const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
        orbitLine.rotation.x = -Math.PI / 2;
        scene.add(orbitLine);

        controls = new OrbitControls(camera, renderer.domElement);
        controls.autoRotate = true;
      }

      function animate() {
        requestAnimationFrame(animate);

        const time = 0.00001 * performance.now();
        const t = time % 1;
        const point = ellipseCurve.getPoint(t);
        earthSystem.position.x = point.x;
        earthSystem.position.z = point.y;

        const moonSpeed = 10;
        const moonOrbitRadius = 50;
        moonMesh.position.x = moonOrbitRadius * Math.cos(time * moonSpeed);
        moonMesh.position.z = moonOrbitRadius * Math.sin(time * moonSpeed);

        sunMesh.rotation.y += 0.001;
        earthMesh.rotation.y += 0.02;
        if (cloudMesh) {
          cloudMesh.rotation.y += 0.018;
        }

        controls.update();
        renderer.render(scene, camera);
      }

      init();
      animate();
    </script>
  </body>
</html>
